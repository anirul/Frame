name: C++ CI with vcpkg and gtest

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        lfs: true
        submodules: true

    - name: Git-lfs pull
      run: |
        git lfs pull
        
    #- name: Install Vulkan SDK
    #  run: |
    #    Invoke-WebRequest -Uri "https://sdk.lunarg.com/sdk/download/1.3.261.1/windows/VulkanSDK-1.3.261.1-Installer.exe" -OutFile "VulkanSDKInstaller.exe"
    #    Start-Process ./VulkanSDKInstaller.exe -ArgumentList "/S" -NoNewWindow -Wait
      
    - name: Bootstrap vcpkg
      shell: cmd
      run: |
        cd external\vcpkg
        bootstrap-vcpkg.bat
        vcpkg integrate install

    # No need for a manual vcpkg install step, the manifest mode will handle it

    - name: Configure with CMake Preset
      run: cmake --preset windows

    - name: Build with CMake Preset
      run: cmake --build --preset windows-release
        
    - name: Run tests using CTest
      shell: cmd
      run: |
        cd build\windows
        ctest -C Release --output-on-failure
